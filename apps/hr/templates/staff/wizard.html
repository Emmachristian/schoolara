{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link href="{% static 'vendors/smartwizard/dist/css/smart_wizard.min.css' %}" rel="stylesheet">
    <style>
        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }
        .form-section-title:first-child {
            margin-top: 0;
        }
        .progress-bar-wrapper {
            margin-bottom: 2rem;
        }
        .step-indicator {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        .errorlist {
            list-style: none;
            padding: 0;
            margin: 0.25rem 0 0 0;
        }
        .errorlist li {
            color: #dc3545;
            font-size: 0.875rem;
        }
        .form-control.is-invalid {
            border-color: #dc3545;
        }

        /* Horizontal radio buttons */
        #id_basic_info-gender {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        #id_basic_info-gender label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        #id_basic_info-gender input[type="radio"] {
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .review-card {
            border-left: 3px solid #3ac47d;
        }

        .field-value {
            color: #495057;
            font-weight: 500;
        }
    </style>
{% endblock %}

{% block content %}
<div class="app-page-title">
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div class="page-title-icon">
                <i class="pe-7s-users icon-gradient bg-happy-itmeo"></i>
            </div>
            <div>
                Staff Member Registration
                <div class="page-title-subheading">Complete the staff registration process in seven simple steps</div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 col-md-12">
        <div class="main-card mb-3 card">
            <div class="card-body">
                <!-- Progress Indicator -->
                <div class="progress-bar-wrapper">
                    <div class="step-indicator">
                        <strong>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</strong>: 
                        {{ current_step_name }}
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" 
                             style="width: {{ progress_percentage }}%"
                             aria-valuenow="{{ progress_percentage }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            {{ progress_percentage|floatformat:0 }}%
                        </div>
                    </div>
                </div>

                <!-- Wizard Form -->
                <form method="post" action="{% url 'hr:staff_create_wizard' %}" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    {{ wizard.management_form }}
                    
                    {% if wizard.form.forms %}
                        {{ wizard.form.management_form }}
                    {% endif %}

                    <!-- Display form errors -->
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger" role="alert">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}

                    <!-- Step 1: Basic Information -->
                    {% if wizard.steps.current == 'basic_info' %}
                        <div class="form-section-title">Personal Details</div>

                        <div class="row">
                            <div class="col-md-3">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Salutation</label>
                                    {{ form.salutation }}
                                    {% if form.salutation.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.salutation.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="position-relative mb-3">
                                    <label class="form-label">First Name <span class="text-danger">*</span></label>
                                    {{ form.first_name }}
                                    {% if form.first_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.first_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Middle Name</label>
                                    {{ form.middle_name }}
                                    {% if form.middle_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.middle_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Last Name <span class="text-danger">*</span></label>
                                    {{ form.last_name }}
                                    {% if form.last_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.last_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                    {{ form.date_of_birth }}
                                    {% if form.date_of_birth.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.date_of_birth.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Gender <span class="text-danger">*</span></label>
                                    <div class="mt-2">
                                        {{ form.gender }}
                                    </div>
                                    {% if form.gender.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.gender.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Marital Status</label>
                                    {{ form.marital_status }}
                                    {% if form.marital_status.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.marital_status.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title">Nationality & Identity</div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Nationality</label>
                                    {{ form.nationality }}
                                    {% if form.nationality.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.nationality.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">National ID</label>
                                    {{ form.national_id }}
                                    {% if form.national_id.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.national_id.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Passport Number</label>
                                    {{ form.passport_number }}
                                    {% if form.passport_number.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.passport_number.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Ethnicity</label>
                                    {{ form.ethnicity }}
                                    {% if form.ethnicity.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.ethnicity.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Religious Affiliation</label>
                                    {{ form.religious_affiliation }}
                                    {% if form.religious_affiliation.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.religious_affiliation.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Profile Photo</label>
                                    {{ form.photo }}
                                    <small class="form-text text-muted">Upload a professional photo (JPG, PNG)</small>
                                    {% if form.photo.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.photo.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 2: Contact Information -->
                    {% if wizard.steps.current == 'contact_info' %}
                        <div class="form-section-title">Primary Contact</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Phone Number <span class="text-danger">*</span></label>
                                    {{ form.phone_number }}
                                    <small class="form-text text-muted">Format: +256xxxxxxxxx</small>
                                    {% if form.phone_number.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.phone_number.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Alternative Phone</label>
                                    {{ form.alternative_phone }}
                                    {% if form.alternative_phone.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.alternative_phone.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Personal Email</label>
                                    {{ form.personal_email }}
                                    {% if form.personal_email.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.personal_email.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title">Emergency Contact</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Emergency Contact Name <span class="text-danger">*</span></label>
                                    {{ form.emergency_contact_name }}
                                    {% if form.emergency_contact_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.emergency_contact_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Relationship <span class="text-danger">*</span></label>
                                    {{ form.emergency_contact_relationship }}
                                    {% if form.emergency_contact_relationship.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.emergency_contact_relationship.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Emergency Contact Phone <span class="text-danger">*</span></label>
                                    {{ form.emergency_contact_phone }}
                                    {% if form.emergency_contact_phone.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.emergency_contact_phone.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Emergency Contact Address</label>
                                    {{ form.emergency_contact_address }}
                                    {% if form.emergency_contact_address.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.emergency_contact_address.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 3: Employment Information -->
                    {% if wizard.steps.current == 'employment_info' %}
                        <div class="form-section-title">Employment Details</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Staff ID</label>
                                    {{ form.staff_id }}
                                    <small class="form-text text-muted">Will be auto-generated if left blank</small>
                                    {% if form.staff_id.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.staff_id.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Date of Joining <span class="text-danger">*</span></label>
                                    {{ form.date_of_joining }}
                                    {% if form.date_of_joining.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.date_of_joining.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Employment Status <span class="text-danger">*</span></label>
                                    {{ form.employment_status }}
                                    {% if form.employment_status.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.employment_status.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Primary Department <span class="text-danger">*</span></label>
                                    {{ form.primary_department }}
                                    {% if form.primary_department.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.primary_department.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Date of Leaving</label>
                                    {{ form.date_of_leaving }}
                                    <small class="form-text text-muted">Leave blank if currently employed</small>
                                    {% if form.date_of_leaving.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.date_of_leaving.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 4: Qualifications -->
                    {% if wizard.steps.current == 'qualifications' %}
                        <div class="form-section-title">Educational Background</div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Educational Qualifications</label>
                                    {{ form.qualification }}
                                    <small class="form-text text-muted">List degrees, certificates, and educational achievements</small>
                                    {% if form.qualification.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.qualification.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Work Experience</label>
                                    {{ form.experience }}
                                    <small class="form-text text-muted">Describe previous work experience and roles</small>
                                    {% if form.experience.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.experience.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title">Skills & Competencies</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Professional Skills</label>
                                    {{ form.skills }}
                                    {% if form.skills.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.skills.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Languages Spoken</label>
                                    {{ form.languages_spoken }}
                                    {% if form.languages_spoken.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.languages_spoken.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Professional Memberships</label>
                                    {{ form.professional_memberships }}
                                    {% if form.professional_memberships.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.professional_memberships.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Certifications</label>
                                    {{ form.certifications }}
                                    {% if form.certifications.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.certifications.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 5: Banking & Statutory Information -->
                    {% if wizard.steps.current == 'banking_info' %}
                        <div class="form-section-title">Banking Information</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Bank Account Name</label>
                                    {{ form.bank_account_name }}
                                    {% if form.bank_account_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.bank_account_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Bank Account Number</label>
                                    {{ form.bank_account_number }}
                                    {% if form.bank_account_number.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.bank_account_number.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Bank Name</label>
                                    {{ form.bank_name }}
                                    {% if form.bank_name.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.bank_name.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Bank Branch</label>
                                    {{ form.bank_branch }}
                                    {% if form.bank_branch.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.bank_branch.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title">Statutory Information</div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Tax Identification Number (TIN)</label>
                                    {{ form.tax_identification_number }}
                                    <small class="form-text text-muted">Uganda Revenue Authority TIN</small>
                                    {% if form.tax_identification_number.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.tax_identification_number.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <label class="form-label">NSSF Number</label>
                                    {{ form.social_security_number }}
                                    <small class="form-text text-muted">National Social Security Fund Number</small>
                                    {% if form.social_security_number.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.social_security_number.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 6: Designation & Contract -->
                    {% if wizard.steps.current == 'designation_contract' %}
                        <div class="form-section-title">Designation Assignment</div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <div class="form-check">
                                        {{ form.create_designation }}
                                        <label class="form-check-label" for="{{ form.create_designation.id_for_label }}">
                                            Assign a designation to this staff member
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="designation-fields" style="display: none;">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Designation</label>
                                        {{ form.designation }}
                                        {% if form.designation.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.designation.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Role Allowance</label>
                                        {{ form.role_allowance }}
                                        {% if form.role_allowance.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.role_allowance.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="position-relative mb-3">
                                        <div class="form-check">
                                            {{ form.is_primary_designation }}
                                            <label class="form-check-label" for="{{ form.is_primary_designation.id_for_label }}">
                                                Set as primary designation
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title mt-4">Contract Setup (Optional)</div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <div class="form-check">
                                        {{ form.create_contract }}
                                        <label class="form-check-label" for="{{ form.create_contract.id_for_label }}">
                                            Create an employment contract
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="contract-fields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Contract Type</label>
                                        {{ form.contract_type }}
                                        {% if form.contract_type.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.contract_type.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Job Title</label>
                                        {{ form.job_title }}
                                        {% if form.job_title.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.job_title.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Contract Start Date</label>
                                        {{ form.contract_start_date }}
                                        {% if form.contract_start_date.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.contract_start_date.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Duration (Months)</label>
                                        {{ form.contract_duration_months }}
                                        {% if form.contract_duration_months.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.contract_duration_months.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="position-relative mb-3">
                                        <label class="form-label">Basic Salary (Monthly)</label>
                                        {{ form.basic_salary }}
                                        {% if form.basic_salary.errors %}
                                            <ul class="errorlist">
                                                {% for error in form.basic_salary.errors %}<li>{{ error }}</li>{% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Step 7: Confirmation -->
                    {% if wizard.steps.current == 'confirmation' %}
                        <div class="text-center py-5">
                            <h3 class="mt-4">Review Staff Information</h3>
                            <div class="mt-3 mb-3">
                                <p class="text-muted">Please review all information before submitting</p>
                            </div>
                        </div>

                        <!-- Basic Information Review -->
                        {% if basic_data %}
                        <div class="card mb-3 review-card">
                            <div class="card-header bg-light">
                                <strong>Basic Information</strong>
                                <button type="submit" name="wizard_goto_step" value="basic_info" 
                                        class="btn btn-sm btn-outline-primary float-end">Edit</button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Name:</strong> <span class="field-value">{{ basic_data.salutation }} {{ basic_data.first_name }} {{ basic_data.middle_name|default:"" }} {{ basic_data.last_name }}</span></p>
                                        <p><strong>Date of Birth:</strong> <span class="field-value">{{ basic_data.date_of_birth|date:"F d, Y" }}</span></p>
                                        <p><strong>Gender:</strong> <span class="field-value">{{ basic_data.gender }}</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Nationality:</strong> <span class="field-value">{{ basic_data.nationality }}</span></p>
                                        <p><strong>National ID:</strong> <span class="field-value">{{ basic_data.national_id|default:"Not provided" }}</span></p>
                                        <p><strong>Marital Status:</strong> <span class="field-value">{{ basic_data.marital_status|default:"Not specified" }}</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Contact Information Review -->
                        {% if contact_data %}
                        <div class="card mb-3 review-card">
                            <div class="card-header bg-light">
                                <strong>Contact Information</strong>
                                <button type="submit" name="wizard_goto_step" value="contact_info" 
                                        class="btn btn-sm btn-outline-primary float-end">Edit</button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Phone:</strong> <span class="field-value">{{ contact_data.phone_number }}</span></p>
                                        <p><strong>Email:</strong> <span class="field-value">{{ contact_data.personal_email|default:"Not provided" }}</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Emergency Contact:</strong> <span class="field-value">{{ contact_data.emergency_contact_name }}</span></p>
                                        <p><strong>Emergency Phone:</strong> <span class="field-value">{{ contact_data.emergency_contact_phone }}</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Employment Information Review -->
                        {% if employment_data %}
                        <div class="card mb-3 review-card">
                            <div class="card-header bg-light">
                                <strong>Employment Information</strong>
                                <button type="submit" name="wizard_goto_step" value="employment_info" 
                                        class="btn btn-sm btn-outline-primary float-end">Edit</button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Staff ID:</strong> <span class="field-value">{{ employment_data.staff_id|default:"Auto-generated" }}</span></p>
                                        <p><strong>Date of Joining:</strong> <span class="field-value">{{ employment_data.date_of_joining|date:"F d, Y" }}</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Employment Status:</strong> <span class="field-value">{{ employment_data.employment_status }}</span></p>
                                        <p><strong>Department:</strong> <span class="field-value">{{ employment_data.primary_department }}</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Designation/Contract Review -->
                        {% if designation_contract_data %}
                        <div class="card mb-3 review-card">
                            <div class="card-header bg-light">
                                <strong>Designation & Contract</strong>
                                <button type="submit" name="wizard_goto_step" value="designation_contract" 
                                        class="btn btn-sm btn-outline-primary float-end">Edit</button>
                            </div>
                            <div class="card-body">
                                {% if designation_contract_data.create_designation %}
                                    <p><strong>Designation:</strong> <span class="field-value">{{ designation_contract_data.designation|default:"Not assigned" }}</span></p>
                                {% else %}
                                    <p class="text-muted">No designation assigned</p>
                                {% endif %}
                                
                                {% if designation_contract_data.create_contract %}
                                    <p><strong>Contract Type:</strong> <span class="field-value">{{ designation_contract_data.contract_type }}</span></p>
                                    <p><strong>Basic Salary:</strong> <span class="field-value">{{ designation_contract_data.basic_salary }} UGX/month</span></p>
                                {% else %}
                                    <p class="text-muted">No contract created</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <div class="alert alert-info">
                            <i class="fa fa-info-circle"></i> If you need to make changes, click the "Edit" button on any section above, or use the "Previous" button below.
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <div class="form-check">
                                        {{ form.confirm_creation }}
                                        <label class="form-check-label" for="{{ form.confirm_creation.id_for_label }}">
                                            I confirm that all information provided is correct <span class="text-danger">*</span>
                                        </label>
                                    </div>
                                    {% if form.confirm_creation.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.confirm_creation.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="position-relative mb-3">
                                    <label class="form-label">Additional Notes</label>
                                    {{ form.additional_notes }}
                                    <small class="form-text text-muted">Optional notes for record keeping</small>
                                    {% if form.additional_notes.errors %}
                                        <ul class="errorlist">
                                            {% for error in form.additional_notes.errors %}<li>{{ error }}</li>{% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <div class="divider mt-4"></div>
                    
                    <!-- Navigation Buttons -->
                    <div class="clearfix">
                        {% if wizard.steps.prev %}
                        <button type="submit" name="wizard_goto_step" value="{{ wizard.steps.prev }}" 
                                class="btn-shadow float-start btn-wide btn-pill btn btn-outline-secondary">
                            <i class="pe-7s-angle-left"></i> Previous
                        </button>
                        {% endif %}

                        {% if wizard.steps.current != 'confirmation' %}
                        <button type="submit" class="btn-shadow btn-wide float-end btn-pill btn-hover-shine btn btn-primary">
                            Next <i class="pe-7s-angle-right"></i>
                        </button>
                        {% else %}
                        <button type="submit" class="btn-shadow btn-wide float-end btn-pill btn-hover-shine btn btn-success btn-lg">
                            <i class="pe-7s-check"></i> Submit Registration
                        </button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="{% static 'vendors/smartwizard/dist/js/jquery.smartWizard.min.js' %}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // Toggle designation fields
        function toggleDesignationFields() {
            if ($('#id_designation_contract-create_designation').is(':checked')) {
                $('#designation-fields').slideDown();
            } else {
                $('#designation-fields').slideUp();
            }
        }

        // Toggle contract fields
        function toggleContractFields() {
            if ($('#id_designation_contract-create_contract').is(':checked')) {
                $('#contract-fields').slideDown();
            } else {
                $('#contract-fields').slideUp();
            }
        }

        // Initial checks
        toggleDesignationFields();
        toggleContractFields();

        // Listen for changes
        $('#id_designation_contract-create_designation').on('change', toggleDesignationFields);
        $('#id_designation_contract-create_contract').on('change', toggleContractFields);
    });
</script>
{% endblock %}